<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="/styles/main.css">
    <script src="https://pixijs.download/release/pixi.min.js"></script>
  </head>
  <body>
    <script type="module">
      import { drawWorld } from "/world.js";
      import { Submarine } from "/submarine.js";
      import { initFishes, Fish } from "/fishes.js";
      import { initKelp } from "/ground.js";

      const app = new PIXI.Application();
      app.stage.interactive = true;

      await app.init({ width: 1024, height: 720 });
      const screen = new PIXI.Container();
      screen.interactive = true;
      screen.buttonMode = true;

      document.body.appendChild(app.canvas);

      await PIXI.Assets.load('assets/ferris.svg');
      await PIXI.Assets.load('assets/submarine.png');
      let bullet_asset = await PIXI.Assets.load('assets/bullet.png');

      let heightmap = [];
      for (let y = 0; y < 30; y++) {
        heightmap.push(-y);
      }
      for (let y = 0; y < 10; y++) {
        heightmap.push(-30);
      }
      for (let y = 30; y > 0; y--) {
        heightmap.push(-y);
      }

      app.stage.addChild(screen);

      const graphics = new PIXI.Graphics();
      drawWorld(graphics, heightmap);
      screen.addChild(graphics);
      window.heightmap = heightmap;
      initFishes(app, screen);
      initKelp(screen);

      const keys = new Set();

      // Add keyboard event listeners
      window.addEventListener("keydown", (e) => {
        keys.add(e.key); 
      });

      window.addEventListener("keyup", (e) => {
        keys.delete(e.key); 
      });

      app.ticker.add(() => {
        submarine.move(keys);
      });


      screen.onmousedown = (e) => {
        let pos  = e.screen;
        submarine.fire(pos.x, pos.y);
      };
      
      let submarine_sprite = PIXI.Sprite.from('assets/submarine.png');
      let submarine = new Submarine(app, screen, submarine_sprite, bullet_asset);
    
      app.stage.addChild(submarine_sprite);

    </script>
            
  </body>
</html>

