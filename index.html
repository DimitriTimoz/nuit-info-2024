<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="/styles/main.css">
    <script src="https://pixijs.download/release/pixi.min.js"></script>
  </head>
  <body>
    <script type="module">
      import { drawWorld } from "/world.js";
      import { Submarine } from "/submarine.js";

      const app = new PIXI.Application();
      await app.init({ width: 1024, height: 720 });
      const screen = new PIXI.Container();

      document.body.appendChild(app.canvas);

      await PIXI.Assets.load('assets/ferris.svg');
      let sprite = PIXI.Sprite.from('assets/ferris.svg');

      let submarine = new Submarine(sprite, screen);
    
      app.stage.addChild(sprite);



      let heightmap = [];
      for (let y = 0; y < 30; y++) {
        heightmap.push(-y);
      }
      for (let y = 0; y < 100; y++) {
        heightmap.push(-30);
      }
      for (let y = 30; y > 0; y--) {
        heightmap.push(-y);
      }

      app.stage.addChild(screen);
      screen.x = -(heightmap.length * 20) / 2;

      const texture = await PIXI.Assets.load('https://pixijs.com/assets/bunny.png');
      const bunny = new PIXI.Sprite(texture);
      bunny.anchor.set(0.5);

      let fishes = [];
      fishes.push(bunny);

      for (let i = 0; i < fishes.length; i++) {
        screen.addChild(fishes[i]);
      }

      const graphics = new PIXI.Graphics();

      drawWorld(graphics, heightmap);

      screen.addChild(graphics);

      // When left key is down, move to the left
      window.addEventListener("keydown", function(e) {
        if (e.key == "ArrowRight") {
          submarine.move("right");
        } else if (e.key == "ArrowLeft") {
          submarine.move("left");
        } else if (e.key == "ArrowUp") {
          submarine.move("up");
        } else if (e.key == "ArrowDown") {
          submarine.move("down");
        }
      });

    </script>
            
  </body>
</html>

